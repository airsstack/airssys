package airssys:core@1.0.0;

// ═════════════════════════════════════════════════════════════════════════════
// LAYER 2: ERROR TYPES INTERFACE
// ═════════════════════════════════════════════════════════════════════════════
//
// This interface defines error types for capability-based security enforcement.
// These error types are used by host functions to communicate capability check
// failures to WASM components.
//
// Architecture: This extends the foundation types from types.wit with security-
// specific error handling for the capability enforcement system (Block 4).

interface errors {
    // ─────────────────────────────────────────────────────────────────────────
    // Capability Enforcement Errors
    // ─────────────────────────────────────────────────────────────────────────
    
    /// Capability check failure errors.
    ///
    /// These errors are returned when a WASM component attempts to access a
    /// host resource without the required capability grant. All errors include
    /// a descriptive message explaining why access was denied.
    ///
    /// # Security Model
    ///
    /// The capability system operates on a **deny-by-default** principle:
    /// - Components without declared capabilities receive `access-denied`
    /// - Invalid or malformed requests receive `invalid-resource`
    /// - Components not properly registered receive `component-not-found`
    /// - Internal security system failures receive `security-error`
    ///
    /// # Usage
    ///
    /// Host functions use these errors to communicate capability check results
    /// to WASM components. Components can inspect the error variant and message
    /// to understand why access was denied and potentially take corrective action.
    ///
    /// # Examples in Host Function Signatures
    ///
    /// ```wit
    /// // Filesystem operation with capability check
    /// filesystem-read: func(path: string) -> result<list<u8>, capability-error>
    ///
    /// // Network operation with capability check
    /// network-connect: func(endpoint: string) -> result<tcp-stream, capability-error>
    ///
    /// // Storage operation with capability check
    /// storage-write: func(key: string, value: list<u8>) -> result<_, capability-error>
    /// ```
    variant capability-error {
        /// Component lacks required capability for the operation.
        ///
        /// This is the most common error, indicating the component attempted
        /// to access a resource or perform an operation that was not explicitly
        /// granted in its capability manifest.
        ///
        /// # Example Message
        ///
        /// ```text
        /// "Component 'my-plugin' attempted to read '/etc/passwd' but only has
        /// capability for '/app/data/*'. Declare additional capabilities in
        /// Component.toml to access this resource."
        /// ```
        access-denied(string),
        
        /// Component not found in security registry.
        ///
        /// This error indicates the component has not been properly registered
        /// with the capability enforcement system. This typically indicates a
        /// bug in the WASM runtime or improper component initialization.
        ///
        /// # Example Message
        ///
        /// ```text
        /// "Component 'unknown-component' not found in capability registry.
        /// Ensure component is registered before invoking host functions."
        /// ```
        component-not-found(string),
        
        /// Invalid resource pattern in capability check.
        ///
        /// This error indicates the resource identifier provided by the component
        /// is malformed, empty, or otherwise invalid. This may indicate a bug in
        /// the component code or an attempt to exploit the system.
        ///
        /// # Example Message
        ///
        /// ```text
        /// "Invalid resource pattern '': resource identifiers cannot be empty."
        /// ```
        invalid-resource(string),
        
        /// Internal security system error.
        ///
        /// This error indicates an unexpected failure in the capability
        /// enforcement system itself. This should be rare and typically
        /// indicates a system-level issue requiring investigation.
        ///
        /// # Example Message
        ///
        /// ```text
        /// "Failed to evaluate security policy: ACL evaluation error.
        /// Contact system administrator."
        /// ```
        security-error(string),
    }
}
